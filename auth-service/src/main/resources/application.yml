server:
  port: 8080

spring:
  application:
    name: auth-service

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/safevision}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    
    # --- CORREÇÃO PRINCIPAL: TUNING DO POOL DE CONEXÕES (HikariCP) ---
    hikari:
      # Mantém 5 conexões abertas e prontas, mesmo sem ninguém usar.
      # Isso elimina o tempo de espera no primeiro login.
      minimum-idle: 5
      
      # Máximo de conexões simultâneas (evita travar o banco).
      maximum-pool-size: 20
      
      # Tempo (ms) que a aplicação espera por uma conexão livre antes de dar erro.
      # 30000ms = 30 segundos (Aumentamos a paciência do serviço).
      connection-timeout: 30000
      
      # Tempo máximo de vida de uma conexão (30 min). Evita conexões "velhas" e quebradas.
      max-lifetime: 1800000
      
      # Tempo que uma conexão pode ficar parada antes de ser reciclada.
      idle-timeout: 300000

  jpa:
    # Fecha a conexão com o banco assim que o Service termina (libera mais rápido).
    open-in-view: false
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        # (Opcional) Melhora performance de inserts em lote
        jdbc:
          batch_size: 50

management:
  endpoints:
    web:
      exposure:
        include: "health,info,prometheus"
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: "http://zipkin:9411/api/v2/spans"

eureka:
  client:
    serviceUrl:
      defaultZone: ${EUREKA_CLIENT_SERVICEURL_DEFAULTZONE:http://localhost:8761/eureka/}
    register-with-eureka: true
    fetch-registry: true

safevision:
  jwt:
    secret: ${SAFEVISION_JWT_SECRET:segredo_padrao_apenas_para_desenvolvimento_local_sem_docker}
    expiration-ms: 86400000

logging:
  file:
    name: /var/logs/${spring.application.name}.log
  logback:
    rollingpolicy:
      max-file-size: 10MB
      max-history: 7
  level:
    root: INFO
    org.springframework.security: DEBUG
    com.safevision: DEBUG
    # Debug para ver se o pool de conexões está funcionando
    com.zaxxer.hikari: INFO